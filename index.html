<!DOCTYPE HTML>
<html>
<head>
	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<link href="/css/styles.css" rel="stylesheet">
	<title>Fooseball Display</title>
</head>
<body>

<div id="game-settings" class="container">
	<div class="row">

		<div class="col-sm-12">
			
			<h1>Players</h1>
			
			<div class="form-group">
			    <label for="blue-player-1-input">Blue Attack </label>
			    <input id="blue-player-1-input" type="text" class="form-control" placeholder="Instagram ID">
			</div>


			<div class="form-group">
			    <label for="blue-player-2-input">Blue Defence </label>
			    <input id="blue-player-2-input" type="text" class="form-control" placeholder="Instagram ID">
			</div>

			<div class="form-group">
			    <label for="red-player-1-input">Red Attack </label>
			    <input id="red-player-1-input" type="text" class="form-control" placeholder="Instagram ID">
			</div>

			<div class="form-group">
			    <label for="red-player-2-input">Red Defence </label>
			    <input id="red-player-2-input" type="text" class="form-control" placeholder="Instagram ID">
			</div>

			<button id="NewGame"  class="btn btn-primary">New Game</button>
		</div>
	</div>
</div>


<div id="scoreboard" class="container">
	<div class="row">
		
		<div class="col-sm-12">
			
			<ul class="Score">
				<li class="players blue">
					<img id="blue-player-1" src="http://avatars.io/instagram/datamouth" class="img-responsive img-circle" width="118px" height="118px" rel="">
					<img id="blue-player-2" src="http://avatars.io/instagram/xcast3d" class="img-responsive img-circle" width="118px" height="118px" rel="">
				</li>
				<li class="score-timer">
					<div class="">
						<div class="blue_points">00</div><div class="red_points">00</div>
						<div id="clock">--</div>​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​
						<a href="#" id="restart" class="btn btn-primary">Restart Game</a>
					</div>
				</li>
				
				<li class="players red">
					<img id="red-player-1" src="http://avatars.io/instagram/s3bastienb" class="img-responsive img-circle" width="118px" height="118px" rel="">
					<img id="red-player-2" src="http://avatars.io/instagram/tonhox06" class="img-responsive img-circle" width="118px" height="118px" rel="">
				</li>
			</ul>
			

			<hr/>

			<!-- Nav tabs -->
			<ul class="nav nav-tabs" role="tablist">
			  <li class="active"><a href="#logs" role="tab" data-toggle="tab">Game Logs</a></li>
			  <li><a href="#controls" role="tab" data-toggle="tab">Controls</a></li>
			  <li><a href="#settings" role="tab" data-toggle="tab">Settings</a></li>
			</ul>

			<!-- Tab panes -->
			<div class="tab-content">
			  <div class="tab-pane active" id="logs">
			  	<ul id="gamelogs">
			  		
			  	</ul>
			  </div>
			  <div class="tab-pane" id="controls">
				<p class="content-padded">Use these controls to overide the sensors on the table.</p>
				<p>Blue Team <button id="blueplus"  class="btn btn-primary">+</button> <button id="bluemin" class="btn btn-negative">-</button></p>
				<p class="content-padded">Red Team <button id="redplus" class="btn btn-primary">+</button> <button id="redmin" class="btn btn-negative">-</button></p>
			  </div>
			  <div class="tab-pane" id="settings">
			  	Coming soon
			  </div>
			</div>


			

    		
		</div>
	</div>

</div>

<nav class="navbar navbar-default navbar-fixed-bottom" role="navigation">
  <div class="container">
    <div id="status" class="alert alert-info" role="alert"> </div>
  </div>
</nav>


<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.velocity.min.js"></script>
<script src="/js/velocity.ui.min.js"></script>
<script src="/socket.io/socket.io.js"></script>

<script type="text/javascript">
	
	jQuery(function($){
		
		var socket = io.connect();

		var blue_points = $(".blue_points");
		var red_points = $(".red_points");
		var alertDiv = $("div.alert");

		var blueround1 = $(".r1-blue"); 
		var blueround2 = $(".r2-blue");
		var blueround3 = $(".r3-blue");

		var redround1 = $(".r1-red");
		var redround2 = $(".r2-red");
		var redround3 = $(".r3-red");

		var currentRound = $(".round");

		var bluePlus = $('#blueplus');
	    var redPlus = $('#redplus');
	    var blueMin = $('#bluemin');
	    var redMin = $('#redmin');
	    var newGame = $('#newGame');

	    var minutes = 0;
		var seconds = 0;

		function sendPlayerNames(){

			var bluePlayer1 = $('#blue-player-1-input').val();
			var bluePlayer2 = $('#blue-player-2-input').val();
			var redPlayer1 = $('#red-player-1-input').val();
			var redPlayer2 = $('#red-player-2-input').val();
			
			socket.emit('players', {bluePlayer1: bluePlayer1, bluePlayer2: bluePlayer2, redPlayer1: redPlayer1, redPlayer2: redPlayer2});
			$("#blue-player-1").attr({
			  src: "http://avatars.io/instagram/"+bluePlayer1,
			  rel: bluePlayer1
			});

			$("#blue-player-2").attr({
			  src: "http://avatars.io/instagram/"+bluePlayer2,
			  rel: bluePlayer2
			});
			$("#red-player-1").attr({
			  src: "http://avatars.io/instagram/"+redPlayer1,
			  rel: redPlayer1
			});
			$("#red-player-2").attr({
			  src: "http://avatars.io/instagram/"+redPlayer2,
			  rel: redPlayer2
			});
		};

		$("#NewGame").click(function(e) {
			e.preventDefault();
			console.log('test');
			socket.emit('status', 'newGame');
			sendPlayerNames();
			$("#game-settings").velocity("transition.slideUpOut");
			$('#scoreboard').delay(800).velocity("transition.bounceIn");
		});

		$("#restart").click(function(e) {
			e.preventDefault();
			socket.emit('status', 'newGame');
			sendPlayerNames();
			second = 0;
			$('#gamelogs').html("");
		});


		
		socket.on('connect', function () {
	        console.log("connected!!");
	        socket.emit('status', 'Display connected');
    	});


		socket.on('disconnect', function () {
	        console.log("disconnected!!");
	        $("#status").html("Lost connection to server!");
	       
    	});

		socket.on('status', function(data){
			
			console.log(data);
			$("#status").html(data);

			if (data == "Starting new Game...") {
				minutes = 0;
	      		seconds = 0;
			};

		});

		socket.on('score-update', function(data){

			// $("li.Score").velocity("callout.pulse");
			var pointTime = data.time;
			console.log('score update received');
			// WIP to parse score msg

			if (blue_points.html() != data.blue) {
				blue_points.html(data.blue);
				$('#gamelogs').prepend('<li>Blue team sores! <span class="scoreby">Tap Player</span> <span class="point-time">'+pointTime+'</span></li>');
			};

			if (red_points.html() != data.red) {
				red_points.html(data.red);
				$('#gamelogs').prepend('<li>Red team sores! <span class="scoreby">Tap Player</span> <span class="point-time">'+pointTime+'</span></li>');
			};

			//console.log(data.time);
		});

		//Scored By function

		$('li.players img').click(function() {

			$('#gamelogs li:first-of-type span.scoreby').html($(this).attr("rel"));


		});

		// Manula score controller
		bluePlus.click(function() {
	      socket.emit('score', 'blueplus');
	    });

	    blueMin.click(function() {
	      socket.emit('score', 'bluemin');
	    });

	    redPlus.click(function() {
	      socket.emit('score', 'redplus');
	    });

	    redMin.click(function() {
	      socket.emit('score', 'redmin');
	    });

	    newGame.click(function() {
	      socket.emit('status', 'newGame');
	    });

	    // Game Clock
		setInterval(function() {
		        updateClock()
		}, 1000);

		function updateClock() {
			second = 0;

		    if (seconds > 59) {
		        seconds -= 60;
		        minutes++;
		    }
		    if (minutes > 23) {
		        minutes = 0;
		    }
		    $("#clock").html(minutes + ':' + seconds);

		    seconds++;
		}
	});

</script>

</body>

</html>